(function(t){function e(e){for(var a,i,s=e[0],l=e[1],c=e[2],u=0,p=[];u<s.length;u++)i=s[u],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&p.push(o[i][0]),o[i]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);d&&d(e);while(p.length)p.shift()();return r.push.apply(r,c||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],a=!0,s=1;s<n.length;s++){var l=n[s];0!==o[l]&&(a=!1)}a&&(r.splice(e--,1),t=i(i.s=n[0]))}return t}var a={},o={app:0},r=[];function i(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=a,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(n,a,function(e){return t[e]}.bind(null,a));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var d=l;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"38fa":function(t,e,n){n("466d"),n("5319"),n("498a"),window.edited=!1,window.timerSave=null,document.addEventListener("DOMContentLoaded",(function(){document.addEventListener("keydown",(function(t){edited=!0,clearTimeout(timerSave),timerSave=setTimeout((function(){edited&&(saveAll(),edited=!1)}),5e3),console.log(t.key),"Escape"==t.key&&t.target.matches("textarea")&&removeTextareas(),"Backspace"==t.key&&t.target.matches("textarea")&&handleKeyBackspace(t),"Delete"==t.key&&t.target.matches("textarea")&&handleKeyDelete(t),"Enter"==t.key&&t.target.matches("textarea")&&!t.shiftKey&&(t.ctrlKey?handleKeyCtrlEnter(t):handleKeyEnter(t)),"Tab"==t.key&&t.target.matches("textarea")&&(t.shiftKey?handleShiftTab(t):handleTab(t)),"ArrowUp"==t.key&&t.target.matches("textarea")&&handleKeyArrowUp(t),"ArrowDown"==t.key&&t.target.matches("textarea")&&handleKeyArrowDown(t),"z"==t.key&&t.ctrlKey&&revertHistory()}))})),window.handleKeyArrowUp=function(t){if(t.shiftKey&&t.altKey){var e=t.target.closest("[data-block]"),n=e.parentNode,a=e.previousSibling;if(!a)return;return n.removeChild(e),n.insertBefore(e,a),editBlock(e)}isFirstLine(t.target)&&(t.preventDefault(),selectPrev())},window.handleKeyArrowDown=function(t){if(t.shiftKey&&t.altKey){var e=t.target.closest("[data-block]"),n=e.parentNode,a=e.nextSibling;if(!a)return;n.removeChild(e);var o=a.nextSibling;return o?n.insertBefore(e,o):n.appendChild(e),editBlock(e)}isLastLine(t.target)&&(t.preventDefault(),selectNext())},window.handleKeyEnter=function(t){t.preventDefault();var e=t.target,n=e.value;e.value=n.substr(0,e.selectionStart).trim();var a=e.closest("[data-block]"),o=document.createElement("li");o.setAttribute("data-block",""),o.setAttribute("data-temp-id",getTempId());var r=document.createElement("p");r.innerHTML=marked(n.substr(e.selectionEnd).trim()),o.appendChild(r),a.nextSibling?a.parentNode.insertBefore(o,a.nextSibling):a.parentNode.appendChild(o),editBlock(o);var i=$("textarea");i.selectionStart=0,i.selectionEnd=0},window.handleKeyCtrlEnter=function(t){t.preventDefault();var e=t.target,n=e.value;n.match(/^\[\[(TODO|DONE)\]\]/)?n.match(/^\[\[TODO\]\]/)?n=n.replace(/^\[\[TODO\]\]/,"[[DONE]]"):n.match(/^\[\[DONE\]\]/)&&(n=n.replace(/^\[\[DONE\]\] */,"")):n="[[TODO]] "+n,e.value=n,setInputHeight(e)},window.handleKeyBackspace=function(t){var e=t.target;if(0==e.selectionStart&&0==e.selectionEnd){var n=e.closest("[data-block]"),a=e.value,o=getPrevBlock(n);if(!o)return;t.preventDefault(),n.parentNode.removeChild(n),editBlock(o),e=o.querySelector("textarea");var r=e.value;e.value=r+a,setInputHeight(e),e.selectionStart=r.length,e.selectionEnd=r.length}},window.handleKeyDelete=function(t){var e=t.target;if(e.selectionStart==e.value.length&&e.selectionEnd==e.value.length){var n=e.closest("[data-block]"),a=getNextBlock(n);if(!a)return;t.preventDefault();var o=unmarked(a.querySelector("p").innerHTML);a.parentNode.removeChild(a);var r=e.value;e.value=r+o,setInputHeight(e),e.selectionStart=r.length,e.selectionEnd=r.length}},window.handleTab=function(t){t.preventDefault();var e=t.target,n=e.closest("[data-block]"),a=n.previousSibling;if(a){var o=a.querySelector("ul");o||(o=document.createElement("ul"),a.appendChild(o)),n.parentNode.removeChild(n),o.appendChild(n),$("textarea").focus()}},window.handleShiftTab=function(t){t.preventDefault();var e=t.target,n=e.closest("[data-block]"),a=n.parentNode;if("UL"==a.tagName){var o=a.closest("[data-block]"),r=o.nextSibling;a.removeChild(n),0==a.querySelectorAll("li").length&&o.removeChild(a),r?o.parentNode.insertBefore(n,r):o.parentNode.appendChild(n),$("textarea").focus()}}},"56d7":function(t,e,n){"use strict";n.r(e);n("d3b7"),n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("a026"),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"wrapper-app"},[n("aside",[n("router-link",{attrs:{to:"/"}},[t._v("Dashboard")])],1),n("main",[n("router-view",{key:t.$route.fullPath})],1),n("loader")],1)},r=[],i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"show",rawName:"v-show",value:t.isLoading,expression:"isLoading"}],staticClass:"ajax-loader"},[t._m(0),t.loadingMessage?n("p",[t._v(t._s(t.loadingMessage))]):t._e()])},s=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"loader-circle"},[n("div",{staticClass:"loader-line-mask"},[n("div",{staticClass:"loader-line"})]),n("div",{staticClass:"loader-img"})])}],l={computed:{isLoading:function(){return this.$store.state.loading},loadingMessage:function(){return this.$store.state.loadingMessage}}},c=l,d=(n("74ae"),n("2877")),u=Object(d["a"])(c,i,s,!1,null,null,null),p=u.exports,m={name:"app",components:{Loader:p},data:function(){return{}},computed:{isAuthenticated:function(){return console.log("this.$store.getters.isAuthenticated",this.$store.getters.isAuthenticated),this.$store.getters.isAuthenticated},editingBlockId:function(){return this.$store.state.editingBlockId}},methods:{},mounted:function(){}},f=m,h=Object(d["a"])(f,o,r,!1,null,null,null),v=h.exports,g=n("bc3a"),b=n.n(g),w=(n("99af"),n("c975"),n("d81d"),n("fb6a"),n("5319"),n("159b"),[]);window.$$=window.$$||function(t,e){e=e||document;var n=e.querySelectorAll(t);return Array.prototype.slice.call(n)},window.$=window.$||function(t,e){return e=e||document,e.querySelector(t)},window.addHistory=function(t){t&&(w.length&&JSON.stringify(t)==JSON.stringify(w[w.length-1])||(w.push(t),console.log("history added",t),w.length>10&&w.shift()))},window.revertHistory=function(){var t=w.pop();console.log("history data",t),t&&hydrate(window.note_id,t)},window.getData=function(){var t=$("textarea");if(t){var e=t.nextSibling;e&&"P"==e.tagName&&(e.innerHTML=marked(t.value))}var n=$$("[data-block]").map((function(t){var e=t.parentNode.closest("[data-block]"),n=null;return e&&(n=e.getAttribute("data-block"),n||(n=e.getAttribute("data-temp-id"))),{id:t.getAttribute("data-block"),parent_id:n,order:getBlockOrder(t),temp_id:t.getAttribute("data-temp-id"),text:unmarked($("p",t).innerHTML)}}));return n},document.addEventListener("click",(function(t){if(console.log("click"),t.target.matches("textarea"))console.log("textarea clicked"),console.log(t),t.stopPropagation();else{var e=t.target.closest("[data-block]");if(!e)return;clickedBlock(e,t)}})),window.getTempId=function(){return window.tempId||(window.tempId=(new Date).getTime()),"temp-"+window.tempId++},window.newBlock=function(t){var e=document.createElement("li");e.setAttribute("data-block",""),e.setAttribute("data-temp-id",getTempId());var n=document.createElement("p");e.appendChild(n);var a=$('[data-note="'.concat(t,'"] .vanilla')),o=$("ul",a);if(!o){o=document.createElement("ul");a.appendChild(o)}o.appendChild(e),editBlock(e)},window.clickedBlock=function(t,e){e.clientX,e.target.getBoundingClientRect().x,e.clientY,e.target.getBoundingClientRect().y;var n=window.getSelection().getRangeAt(0).endOffset;editBlock(t),console.log("clickPos",n);var a=$("textarea");a.focus(),a.selectionStart=n,a.selectionEnd=n},window.editBlock=function(t){console.log("editBlock"),t;var e=t.querySelector("p"),n=e.previousSibling;if(n&&"TEXTAREA"==n.tagName)return n.focus();removeTextareas();var a=document.createElement("textarea");a.value=unmarked(e.innerHTML),t.insertBefore(a,e),a.focus(),setInputHeight(a)},window.updateBlocksRefs=function(t){for(var e in t){var n=t[e],a=document.querySelector('[data-temp-id="'.concat(e,'"]'));a&&(a.removeAttribute("data-temp-id"),a.setAttribute("data-block",n))}},window.saveAll=function(){console.log("saving");var t=$("[data-note]").getAttribute("data-note"),e=getData();addHistory(e),b()({method:"post",url:"/api/notes/save-blocks/"+t,data:e}).then((function(t){updateBlocksRefs(t.data)})).catch((function(t){console.error("save error"),console.error(t)}))},window.getBlockOrder=function(t){var e=$$("[data-block]");return e.indexOf(t)+1},window.getPrevBlock=function(t){t||(t=$("textarea").closest("[data-block]"));var e=$$("[data-block]"),n=e.indexOf(t);if(0!=n)return e[n-1]},window.selectPrev=function(){var t=getPrevBlock(t);if(t){var e=getCarretPosition();editBlock(t);var n=$("textarea"),a=getSelectionEnd(n,e.x);n.selectionStart=a,n.selectionEnd=a}},window.getNextBlock=function(t){t||(t=$("textarea").closest("[data-block]"));var e=$$("[data-block]"),n=e.indexOf(t);if(n!=e.length-1)return e[n+1]},window.selectNext=function(t){t=getNextBlock(t);if(t){var e=getCarretPosition();editBlock(t);var n=$("textarea"),a=getSelectionStart(n,e.x);n.selectionStart=a,n.selectionEnd=a}},window.hydrate=function(t,e){window.note_id=t,$('[data-note="'.concat(t,'"] .vanilla')).innerHTML=build_html(e)},window.build_html=function(t,e,n){e=e||null,n=n||0;var a="";return t.forEach((function(o){o.parent_id==e&&(a+='<li data-block="'.concat(o.id,'">'),a+="<p>".concat(marked(o.text),"</p>"),a+=build_html(t,o.id,n+1),a+="</li>")})),a?"<ul>".concat(a,"</ul>"):""},window.saferEval=function(t,e){try{return new Function(["$data"],"var result; with($data) { result = ".concat(t," }; return result"))(e)}catch(n){return void console.log("Safer eval error: "+n)}},window.toastr=function(t,e,n,a){e=e||"",n=n||"#007aff",a=a||2+t.length/50;var o=document.createElement("div");o.className="toast show",o.setAttribute("style","min-width:200px; position: fixed; bottom: 10px; right: 10px;"),o.innerHTML='\n\t<div class="toast-header">\n\t<svg class="bd-placeholder-img rounded mr-2" width="20" height="20" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img"><rect width="100%" height="100%" fill="'.concat(n,'"></rect></svg>\n\t<strong>').concat(e,'</strong>\n\t</div>\n\t<div class="toast-body">\n\t').concat(t,"\n\t</div>"),document.body.appendChild(o),setTimeout((function(){document.body.removeChild(o)}),1e3*a)},window.marked=function(t){return t?(t=t.replace("[[TODO]]",'<span class="checkbox"></span>'),t=t.replace("[[DONE]]",'<span class="checkbox checked"></span>'),t):""},window.unmarked=function(t){return t?(t=t.replace('<span class="checkbox"></span>',"[[TODO]]"),t=t.replace('<span class="checkbox checked"></span>',"[[DONE]]"),t):""};n("c040"),n("38fa"),n("7d05");var k=n("8c4f"),x=(n("4de4"),n("7db0"),n("4e82"),n("a434"),n("2f62"));a["a"].use(x["a"]);var _=new x["a"].Store({state:{user:{id:null,email:"",is_admin:!1},authInitialized:!1,intendedUrl:"",notes:[],note:{},blocks:[],oldText:"",editingBlockId:null,loading:0,loadingMessage:""},mutations:{startLoading:function(t){t.loading+=1},stopLoading:function(t){t.loading>0&&(t.loading-=1)},setLoadingMessage:function(t,e){t.loadingMessage=e},setIntendedUrl:function(t,e){t.intendedUrl=e},authInitialized:function(t){t.authInitialized=!0},setUser:function(t,e){t.user=e},setEditingBlockId:function(t,e){t.editingBlockId=e},setOldText:function(t,e){t.oldText=e}},actions:{startLoading:function(t){var e=t.commit;e("startLoading")},stopLoading:function(t){var e=t.commit;e("stopLoading"),0==this.state.loading&&this.state.loadingMessage&&e("setLoadingMessage","")},setLoadingMessage:function(t,e){var n=t.commit,a=e.message;n("setLoadingMessage",a)},setUser:function(t,e){var n=t.commit;n("setUser",e)},setIntendedUrl:function(t,e){var n=t.commit;n("setIntendedUrl",e)},authInitialized:function(t,e){var n=t.commit;n("authInitialized",e)},getNote:function(t,e){var n=this,a=t.state;return this.dispatch("startLoading"),b()({url:"/api/notes/"+e}).then((function(t){return a.note=t.data,a.blocks=t.data.blocks,t})).catch((function(t){toastr("No permisson to view this project","Error","#cc0000"),n.$router.replace("/")})).finally((function(){n.dispatch("stopLoading")}))},editBlock:function(t,e){var n=t.commit,a=t.state;if(null!==a.editingBlockId&&this.dispatch("saveBlock"),n("setEditingBlockId",e),null!==e){var o=this.getters.block;n("setOldText",o.text),setTimeout((function(){document.querySelector("textarea").focus()}),1)}},postCreate:function(t,e){t.state;var n=e.data,a=e.fn;b()({method:"post",url:"/api/blocks",data:n}).then((function(t){a&&a(t)})).catch((function(t){console.error("save error"),console.error(t)}))},postUpdate:function(t,e){t.state;var n=e.id,a=e.data,o=e.fn;console.log("postupdate",n,a,o),b()({method:"post",url:"/api/blocks/"+n,data:a}).then((function(t){o&&o(t)})).catch((function(t){console.error("save error"),console.error(t)}))},postBatch:function(t,e){t.state;var n=e.data,a=e.fn;console.log("postbatch"),b()({method:"post",url:"/api/blocks/batch",data:n}).then((function(t){a&&a(t)})).catch((function(t){console.error("save error"),console.error(t)}))},saveBlock:function(t){var e=t.state;console.log("saveBlock");var n=this.getters.block;if(n){var a=document.querySelector("textarea").value;if(n.id&&e.oldText==a)console.log("same text, skip saving");else{var o={text:a,order:n.order,parent_id:n.parent_id,note_id:n.note_id};n.id?this.dispatch("postUpdate",{id:n.id,data:o,fn:function(t){n.id=t.data.id}}):this.dispatch("postCreate",{data:o,fn:function(t){n.id=t.data.id}}),n.id="saving"}}},saveAndNew:function(t){t.state;console.log("saveAndNew");var e=this.getters.block;this.dispatch("saveBlock"),this.dispatch("newBlock",{order:e.order,parent_id:e.parent_id})},newBlock:function(t,e){var n=t.state,a=e.order,o=e.parent_id;console.log("new"),n.blocks.push({text:"",note_id:n.note.id,id:"",order:a||1,parent_id:o||null}),this.dispatch("editBlock","")},moveUp:function(t){t.state;var e=this.getters.block;if(e){var n=this.getters.children(e.parent_id),a=n.indexOf(e),o=n[a-1];if(o){var r=e.order;e.order=o.order,o.order=r;var i=[{id:o.id,order:o.order}];e.id&&i.push({id:e.id,order:e.order}),this.dispatch("postBatch",{data:i}),setTimeout((function(){document.querySelector("textarea").focus()}),1)}}},editPrev:function(t){t.state;var e=this.getters.block;if(e){var n=this.getters.children(e.parent_id),a=n.indexOf(e),o=n[a-1];o&&this.dispatch("editBlock",o.id)}},moveDown:function(t){t.state;var e=this.getters.block;if(e){var n=this.getters.children(e.parent_id),a=n.indexOf(e),o=n[a+1];if(o){var r=e.order;e.order=o.order,o.order=r;var i=[{id:o.id,order:o.order}];e.id&&i.push({id:e.id,order:e.order}),this.dispatch("postBatch",{data:i}),setTimeout((function(){document.querySelector("textarea").focus()}),1)}}},editNext:function(t){t.state;var e=this.getters.block;if(e){var n=this.getters.children(e.parent_id),a=n.indexOf(e),o=n[a+1];o&&this.dispatch("editBlock",o.id)}},indent:function(t){t.state;var e=this.getters.block;if(e){var n=this.getters.children(e.parent_id),a=n.indexOf(e),o=n[a-1];if(o){var r=o.id,i=this.getters.children(r),s=1;i.length&&(s=i[i.length-1].order+1),e.parent_id=r,e.order=s,setTimeout((function(){document.querySelector("textarea").focus()}),1),e.id&&this.dispatch("postUpdate",{id:e.id,data:{parent_id:e.parent_id,order:e.order}})}}},unindent:function(t){var e=t.state,n=this.getters.block;if(n&&null!=n.parent_id){var a=n.parent_id,o=e.blocks.find((function(t){return t.id==a}));n.parent_id=o.parent_id,n.order=o.order+1,setTimeout((function(){document.querySelector("textarea").focus()}),1),n.id&&this.dispatch("postUpdate",{id:n.id,data:{parent_id:n.parent_id,order:n.order}})}},cancelEditing:function(t){t.state;this.dispatch("editBlock",null)},deleteBlock:function(t){t.state;console.log("delete block");var e=this.getters.block;e.id&&b()({method:"delete",url:"/api/blocks/"+e.id}).then((function(t){})).catch((function(t){console.error("save error"),console.error(t)})),this.dispatch("removeBlock",e)},removeBlock:function(t,e){var n=t.state;console.log("removeBlock");var a=this.getters.children(e.parent_id),o=a[a.indexOf(e)-1],r=o?o.id:null;n.blocks.splice(n.blocks.indexOf(e),1),this.dispatch("editBlock",r)}},getters:{isAuthenticated:function(t){return t.authInitialized&&t.user&&t.user.id},editingBlock_id:function(t){return t.editingBlockId},children:function(t,e){return function(n){return e.sort(t.blocks.filter((function(t){return t.parent_id==n})))}},sort:function(){return function(t){return t.sort((function(t,e){return t.order!=e.order?t.order>e.order?1:-1:t.id?t.id>e.id?1:-1:1}))}},blocks:function(t,e){return e.sort(t.blocks)},block:function(t){return null===t.editingBlockId?null:t.blocks.find((function(e){return e.id==t.editingBlockId}))}}}),y=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"dashboard"},[n("div",{staticClass:"container"},[t._m(0),n("form",{on:{submit:function(e){return e.preventDefault(),t.newNote(e)}}},[t._v(" new note"),n("input",{directives:[{name:"model",rawName:"v-model",value:t.note.name,expression:"note.name"}],attrs:{required:""},domProps:{value:t.note.name},on:{input:function(e){e.target.composing||t.$set(t.note,"name",e.target.value)}}})]),n("div",{staticClass:"notes"},t._l(t.notes,(function(e){return n("div",{key:e.id,staticClass:"item"},[n("router-link",{attrs:{to:"/"+e.slug}},[t._v(t._s(e.slug))])],1)})),0)])])},C=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"d-flex align-items-center justify-content-between my-3"},[n("h1",[t._v("Notes")])])}],B=(n("b0c0"),{name:"dashboard",components:{},data:function(){return{notes:[],note:{name:""}}},methods:{getNotes:function(){var t=this;this.$store.dispatch("startLoading"),b()({url:"/api/notes"}).then((function(e){t.notes=e.data})).finally((function(){t.$store.dispatch("stopLoading")}))},newNote:function(){var t=this;if(!this.note.name)return!1;this.$store.dispatch("startLoading");var e=this.note;b()({method:"post",url:"/api/notes",data:e}).then((function(e){t.$router.push({path:e.data.slug})})).finally((function(){t.$store.dispatch("stopLoading")}))}},created:function(){this.getNotes()}}),E=B,N=(n("9fe9"),Object(d["a"])(E,y,C,!1,null,"ad038b90",null)),L=N.exports,O=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"container",attrs:{"data-note":t.note.id}},[n("div",{staticClass:"my-3"},[n("h1",[t._v(t._s(t.note.name))])]),t._m(0)])])},S=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"blocks"},[n("div",{staticClass:"vanilla"},[n("ul")])])}],T=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ul",{attrs:{"data-level":t.level}},t._l(t.levelBlocks,(function(e){return n("li",{key:e.id},[n("div",{staticClass:"block-content"},[null!==t.editingBlockId&&t.editingBlockId==e.id?n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.text,expression:"block.text"}],key:e.id,domProps:{value:e.text},on:{input:[function(n){n.target.composing||t.$set(e,"text",n.target.value)},t.setLayerHeight],focus:t.setLayerHeight,keydown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"enter",13,n.key,"Enter")?null:t.handleEnter(n,e)}}}):t._e(),n("p",{domProps:{innerHTML:t._s(t.marked(e.text))},on:{click:function(n){return t.editBlock(e.id)}}})]),n("block-list",{attrs:{blocks:t.blocks,level:t.level+1,parent_id:e.id,note_id:t.note_id}})],1)})),0)},j=[],D=(n("466d"),{name:"BlockList",components:{},props:["blocks","level","parent_id","note_id"],data:function(){return{}},computed:{editingBlockId:function(){return this.$store.state.editingBlockId},levelBlocks:function(){var t=this;return this.blocks.filter((function(e){return e.parent_id==t.parent_id}))}},methods:{handleEnter:function(t){if(console.log("enter"),t.ctrlKey){var e=this.$store.getters.block;return e.text.match(/^\[\[(TODO|DONE)\]\]/)?e.text.match(/^\[\[TODO\]\]/)?e.text=e.text.replace(/^\[\[TODO\]\]/,"[[DONE]]"):e.text.match(/^\[\[DONE\]\]/)&&(e.text=e.text.replace(/^\[\[DONE\]\] */,"")):e.text="[[TODO]] "+e.text,void t.preventDefault()}t.shiftKey||(this.$store.dispatch("saveAndNew"),t.preventDefault())},editBlock:function(t){console.log("starteditblock"),this.$store.dispatch("editBlock",t)}},mounted:function(){}}),P=D,A=Object(d["a"])(P,T,j,!1,null,null,null),M=A.exports,H={name:"note",components:{BlockList:M},props:["slug"],data:function(){return{note_id:null}},computed:{note:function(){return this.$store.state.note}},methods:{addHistory:function(){window.addHistory()},revertHistory:function(){window.revertHistory()}},created:function(){var t=this;this.$store.dispatch("getNote",this.slug).then((function(e){t.note_id=e.data.id,hydrate(e.data.id,e.data.blocks),0==e.data.blocks.length&&window.newBlock(e.data.id)}))}},I=H,U=Object(d["a"])(I,O,S,!1,null,"c4e1d640",null),q=U.exports,K=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"container"},[n("div",{staticClass:"my-3"},[n("h1",[t._v(t._s(t.project.name))]),n("p",{staticClass:"text-muted"},[n("a",{attrs:{href:t.url(t.project.slug),target:"_blank"}},[t._v(t._s(t.url(t.project.slug)))])]),n("div",{staticClass:"row"},[n("div",{staticClass:"col"},[n("dl",[n("dt",[t._v("Domain")]),n("dd",[n("span",[t._v(t._s(t.project.domain||"(not set)"))]),n("button",{staticClass:"btn ml-1  btn-sm btn-light",on:{click:t.openModalDomain}},[t._v("Configure")])])])]),t.project.domain?n("div",{staticClass:"col"},[n("dl",[n("dt",[t._v("State")]),n("dd",[t.project.is_published?n("span",[n("a",{on:{click:function(e){return e.preventDefault(),t.openModalUnpublish(e)}}},[n("i",{staticClass:"state-published"}),t._v(" Published ")])]):t._e(),t.project.is_published?t._e():n("span",[n("a",{on:{click:function(e){return e.preventDefault(),t.openModalPublish(e)}}},[n("i",{staticClass:"state-unpublished"}),t._v(" Unpublished ")])])])])]):t._e()]),n("router-link",{staticClass:"btn btn-light btn-sm",attrs:{to:"/project/"+t.project.id+"/edit"}},[t._v("Edit project")]),n("router-link",{staticClass:"btn btn-light btn-sm",attrs:{to:{name:"project-tables",params:{project_id:t.project.id}}}},[t._v("Admin")]),t.project.domain?n("router-link",{staticClass:"btn btn-light btn-sm",attrs:{to:{name:"form-history",params:{project_id:t.project.id}}}},[t._v("Form history")]):t._e(),t.project.tables&&t.project.tables.length>0?n("p",{staticClass:"text-muted"},[n("a",{attrs:{href:t.urladmin(),target:"_blank"}},[t._v("Painel Admin")])]):t._e()],1),n("h3",[t._v("Pages")]),n("table",{staticClass:"table"},[n("tbody",t._l(t.project.pages,(function(e){return n("tr",[n("td",[t._v(t._s(e.name))]),n("td",{staticClass:"text-nowrap"},[t._v(" "+t._s(e.slug)+" "),n("a",{staticClass:"ml-2",attrs:{href:t.url(t.project.slug,e.slug),target:"_blank"}},[n("svg",{staticClass:"icosvg",attrs:{viewBox:"0 0 24 24"}},[n("path",{attrs:{fill:"currentColor",d:"M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z"}})])])]),n("td",{staticClass:"text-right text-nowrap"},[n("router-link",{staticClass:"btn btn-sm btn-primary mr-2",attrs:{to:"/project/"+t.project.id+"/"+e.id}},[n("span",{staticClass:"is-desktop"},[e.output?n("span",[t._v("edit page")]):n("span",[t._v("start building page")])]),n("svg",{staticClass:"is-mobile icosvg",attrs:{viewBox:"0 0 24 24"}},[n("path",{attrs:{fill:"currentColor",d:"M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"}})])]),n("button",{staticClass:"btn btn-sm btn-link has-text-danger",on:{click:function(n){return t.removePage(e)}}},[n("svg",{staticClass:"icosvg",attrs:{viewBox:"0 0 24 24"}},[n("path",{attrs:{fill:"currentColor",d:"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"}})])])],1)])})),0)]),n("button",{staticClass:"btn btn-primary",on:{click:t.newPage}},[t._v("New page")]),t.isAdmin?n("button",{staticClass:"btn btn-warning",on:{click:t.openModalSaveTemplate}},[t._v("save as template")]):t._e()])])},R=[],V={name:"project",components:{},props:["id"],data:function(){return{modalDomain:!1,modalTemplate:!1,modalPublish:!1,modalUnpublish:!1}},computed:{project:function(){return this.$store.getters.project},isAdmin:function(){return this.$store.getters.user.is_admin}},methods:{openModalSaveTemplate:function(){this.modalTemplate=!0},openModalDomain:function(){this.modalDomain=!0},openModalUnpublish:function(){this.modalUnpublish=!0},openModalPublish:function(){this.modalPublish=!0},url:function(t,e){var n="https://"+t+".boldjournaling.com";return e&&(n+="/"+e.replace(/\/$/,"")),n},urladmin:function(){var t=this.project.domain;if(t)var e="https://"+t;else e="https://"+this.project.slug+".boldjournaling.com";return e+="/admin?token="+this.project.token,e},dataBr:function(t){var e=new Date(t);return("0"+e.getDate()).substr(-2)+"/"+("0"+(e.getMonth()+1)).substr(-2)+"/"+e.getFullYear()},getProject:function(){var t=this;this.$store.dispatch("startLoading"),this.$store.dispatch("getProject",this.id).catch((function(e){toastr("No permisson to view this project","Error","#cc0000"),t.$router.replace("/")})).finally((function(){t.$store.dispatch("stopLoading")}))},newPage:function(){var t=this,e=prompt("Page name");e&&b()({method:"post",url:"/api/pages",data:{name:e,project_id:this.id}}).then((function(e){t.$router.push("/project/"+t.id+"/"+e.data.id)}))},removePage:function(t){var e=this;confirm("Remove page?")&&b()({method:"delete",url:"/api/page/"+t.id}).then((function(t){e.getProject()}))}},mounted:function(){console.log("id",this.id),this.getProject()}},z=V,J=Object(d["a"])(z,K,R,!1,null,"fc4871f8",null),F=J.exports,W=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container"},[n("h1",{staticClass:"mt-5 mb-3 text-center"},[t._v("Bold Journaling")]),t.error?n("div",{staticClass:"alert alert-danger"},[t._v(t._s(t.error))]):t._e(),n("div",{staticClass:"row"},[n("div",{staticClass:"col-lg-6"},[n("div",{staticClass:"card"},[n("div",{staticClass:"card-header"},[t._v("Login")]),n("div",{staticClass:"card-body"},[n("form",{on:{submit:function(e){return e.preventDefault(),t.onSubmitLogin(e)}}},[n("div",{staticClass:"form-group"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.login.email,expression:"login.email"}],staticClass:"form-control",attrs:{type:"email",placeholder:"E-mail",required:""},domProps:{value:t.login.email},on:{input:function(e){e.target.composing||t.$set(t.login,"email",e.target.value)}}})]),n("div",{staticClass:"form-group"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.login.password,expression:"login.password"}],staticClass:"form-control",attrs:{type:"password",placeholder:"Password",required:""},domProps:{value:t.login.password},on:{input:function(e){e.target.composing||t.$set(t.login,"password",e.target.value)}}}),n("small",{staticClass:"form-text text-muted text-right"},[n("router-link",{attrs:{to:"forgot"}},[t._v("forgot password")])],1)]),n("button",{staticClass:"btn btn-primary",attrs:{type:"submit"}},[t._v("Login")])])])])]),n("div",{staticClass:"col-lg-6"},[n("div",{staticClass:"card"},[n("div",{staticClass:"card-header"},[t._v("Register")]),n("div",{staticClass:"card-body"},[n("form",{on:{submit:function(e){return e.preventDefault(),t.onSubmitRegister(e)}}},[n("div",{staticClass:"form-group"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.register.name,expression:"register.name"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Name",required:""},domProps:{value:t.register.name},on:{input:function(e){e.target.composing||t.$set(t.register,"name",e.target.value)}}})]),n("div",{staticClass:"form-group"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.register.email,expression:"register.email"}],staticClass:"form-control",attrs:{type:"text",placeholder:"E-mail",required:""},domProps:{value:t.register.email},on:{input:function(e){e.target.composing||t.$set(t.register,"email",e.target.value)}}})]),n("div",{staticClass:"form-group"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.register.password,expression:"register.password"}],staticClass:"form-control",attrs:{type:"password",placeholder:"Password",required:""},domProps:{value:t.register.password},on:{input:function(e){e.target.composing||t.$set(t.register,"password",e.target.value)}}})]),n("button",{staticClass:"btn btn-primary",attrs:{type:"submit"}},[t._v("Register")])])])])])])])},Y=[],Z={data:function(){return{error:"",login:{email:"",password:""},register:{name:"",email:"",password:""}}},methods:{onSubmitLogin:function(){var t=this;this.error="",b()({method:"post",url:"/api/login",data:this.login}).then((function(e){t.$store.dispatch("setUser",e.data);var n=t.$store.state.intendedUrl;"/login"!=n&&n||(n="/"),t.$router.push({path:n})})).catch((function(e){t.error=e.response.data}))},onSubmitRegister:function(){var t=this;this.error="",b()({method:"post",url:"/api/register",data:this.register}).then((function(e){t.$store.dispatch("setUser",e.data);var n=t.$store.state.intendedUrl;"/login"!=n&&n||(n="/"),t.$router.push({path:n})})).catch((function(e){t.error=e.response.data}))}},mounted:function(){}},X=Z,G=Object(d["a"])(X,W,Y,!1,null,"1284db2f",null),Q=G.exports,tt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container"},[n("h1",{staticClass:"mt-5 mb-3 text-center"},[t._v("Bold Journaling")]),t.error?n("div",{staticClass:"alert alert-danger"},[t._v(t._s(t.error))]):t._e(),n("div",{staticClass:"w-50 mx-auto"},[n("div",{staticClass:"card"},[n("div",{staticClass:"card-header"},[t._v("Password recovery")]),n("div",{staticClass:"card-body"},[n("form",{on:{submit:function(e){return e.preventDefault(),t.onSubmit(e)}}},[n("div",{staticClass:"form-group"},[n("label",[t._v("E-mail")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.login.email,expression:"login.email"}],staticClass:"form-control",attrs:{type:"text",required:""},domProps:{value:t.login.email},on:{input:function(e){e.target.composing||t.$set(t.login,"email",e.target.value)}}})]),n("button",{staticClass:"btn btn-primary",attrs:{type:"submit"}},[t._v("Recover")])])])]),n("p",{staticClass:"text-center mt-3"},[n("router-link",{attrs:{to:"login"}},[t._v("Back to login")])],1)])])},et=[],nt={data:function(){return{error:"",login:{email:""}}},methods:{onSubmit:function(){var t=this;this.error="",b()({method:"post",url:"/api/forgot",data:this.login}).then((function(t){alert("mensagem enviada")})).catch((function(e){t.error=e.response.data}))}},mounted:function(){}},at=nt,ot=Object(d["a"])(at,tt,et,!1,null,"69c99584",null),rt=ot.exports,it=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container"},[n("h1",{staticClass:"mt-5 mb-3 text-center"},[t._v("Bold Journaling")]),t.error?n("div",{staticClass:"alert alert-danger"},[t._v(t._s(t.error))]):t._e(),n("div",{staticClass:"w-50 mx-auto"},[n("div",{staticClass:"card"},[n("div",{staticClass:"card-header"},[t._v("Set a new password")]),n("div",{staticClass:"card-body"},[n("form",{on:{submit:function(e){return e.preventDefault(),t.onSubmit(e)}}},[n("div",{staticClass:"form-group"},[n("label",[t._v("E-mail")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.login.email,expression:"login.email"}],staticClass:"form-control",attrs:{type:"text",readonly:""},domProps:{value:t.login.email},on:{input:function(e){e.target.composing||t.$set(t.login,"email",e.target.value)}}})]),n("div",{staticClass:"form-group"},[n("label",[t._v("New password")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.login.password,expression:"login.password"}],staticClass:"form-control",attrs:{type:"password"},domProps:{value:t.login.password},on:{input:function(e){e.target.composing||t.$set(t.login,"password",e.target.value)}}})]),n("button",{staticClass:"btn btn-primary",attrs:{type:"submit"}},[t._v("Save")])])])])])])},st=[],lt=(n("841c"),n("1276"),{data:function(){return{error:"",login:{email:"",password:"",token:""}}},methods:{onSubmit:function(){var t=this;this.error="",b()({method:"post",url:"/api/new-password",data:this.login}).then((function(e){alert("New password successfully set"),t.$router.push("login")})).catch((function(e){t.error=e.response.data}))}},mounted:function(){var t=window.location.search.replace(/^\?/,""),e=t.split("&"),n={};for(var a in e){var o=e[a].split("=");n[o[0]]=o[1]}this.login.email=decodeURIComponent(n.email),this.login.token=decodeURIComponent(n.token)}}),ct=lt,dt=Object(d["a"])(ct,it,st,!1,null,"2d8c4571",null),ut=dt.exports;a["a"].use(k["a"]);var pt=new k["a"]({mode:"history",routes:[{path:"/",name:"dashboard",component:L,meta:{restricted:!0}},{path:"/login",name:"login",component:Q,props:!0,meta:{restricted:!1}},{path:"/forgot",name:"forgot",component:rt,props:!0,meta:{restricted:!1}},{path:"/new-password",name:"new-password",component:ut,props:!0,meta:{restricted:!1}},{path:"/:slug",name:"note",component:q,props:!0,meta:{restricted:!0}},{path:"/:slug/:id",name:"block",component:F,props:!0,meta:{restricted:!0}}]});pt.beforeEach((function(t,e,n){return console.log("route beforeeach to: ",t.path),edited&&$("[data-note]")&&saveAll(),"/logout"==t.path?(b()({method:"get",url:"/api/logout"}).then((function(t){_.dispatch("setUser",{})})).catch((function(t){console.log("error",t)})),n("/login")):!_.getters.isAuthenticated&&t.meta.restricted?(_.dispatch("setIntendedUrl",t.path),n("/login")):void n()}));var mt=pt;window.Vue=a["a"],a["a"].config.productionTip=!1,b()({method:"get",url:"/api/user"}).then((function(t){_.dispatch("setUser",t.data),_.dispatch("authInitialized")})).catch((function(){_.dispatch("authInitialized")})).finally((function(){window.vm=new a["a"]({router:mt,store:_,render:function(t){return t(v)}}).$mount("#app")}))},"74ae":function(t,e,n){"use strict";var a=n("b4ad"),o=n.n(a);o.a},"7d05":function(t,e,n){},"9fe9":function(t,e,n){"use strict";var a=n("ef95"),o=n.n(a);o.a},b4ad:function(t,e,n){},c040:function(t,e,n){n("159b"),document.addEventListener("DOMContentLoaded",(function(){document.addEventListener("input",(function(t){t.target.matches("textarea")&&setInputHeight(t.target)}))})),window.setInputHeight=function(t){t.style.height="1.5em";var e=t.scrollHeight;t.style.height=e+"px"},window.removeTextareas=function(){$$("textarea").forEach((function(t){var e=t.nextSibling;e&&"P"==e.tagName&&(e.innerHTML=marked(t.value),t.parentNode.removeChild(t))}))},window.getSelectionEnd=function(t,e,n){var a=t.value,o=a,r=document.createElement("span");r.className="calculate",r.style.width=t.offsetWidth+"px";var i=document.createTextNode(o);r.appendChild(i);var s=document.createElement("span");s.id="carret",r.appendChild(s),document.body.appendChild(r),console.time("loopx");while(s.offsetLeft>e)o=a.substr(0,o.length-1),i.textContent=o;return console.timeEnd("loopx"),$$(".calculate").forEach((function(t){t.parentNode.removeChild(t)})),o.length},window.getSelectionStart=function(t,e){var n=t.value,a="",o=document.createElement("span");o.className="calculate",o.style.width=t.offsetWidth+"px";var r=document.createTextNode(a);o.appendChild(r);var i=document.createElement("span");i.id="carret",o.appendChild(i),document.body.appendChild(o);while(i.offsetLeft<e)if(a=n.substr(0,a.length+1),r.textContent=a,n.length==a.length)break;return a=n.substr(0,a.length-1),$$(".calculate").forEach((function(t){t.parentNode.removeChild(t)})),a.length},window.getCarretPosition=function(){var t=$("textarea"),e=document.createElement("span");e.className="calculate";var n=t.value.substr(0,t.selectionStart);e.innerHTML=n+'<span id="carret"></span>',e.style.width=t.offsetWidth+"px",document.body.appendChild(e);var a=e.querySelector("#carret"),o={x:a.offsetLeft+4,y:a.offsetTop};return $$(".calculate").forEach((function(t){t.parentNode.removeChild(t)})),o},window.isFirstLine=function(t){var e=getCarretPosition();return console.log("getCarretPosition first line",e),0==e.y},window.isLastLine=function(t){var e=document.createElement("span");e.className="calculate",e.style.width=t.offsetWidth+"px",e.innerHTML=t.value+'<span id="carret"></span>',document.body.appendChild(e);var n=e.querySelector("#carret"),a={x:n.offsetLeft,y:n.offsetTop},o=getCarretPosition();return console.log("getCarretPosition last line",o,a),o.y==a.y}},ef95:function(t,e,n){}});
//# sourceMappingURL=app.62da3f1e.js.map